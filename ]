module Toui
  class Input
    include Element

    def initialize name:, block:, context:
      super
      @visible = true
      @keys = {
        [:ctrl, ?c] => -> { exit },
        [:ctrl, ?u] => -> { own.text = String.new }
      }
      instance_exec &block
    end

    def << key
      case key
      when Symbol
        action = @keys[key]
        @context[self].instance_exec &wrap(action) if action
      when /[[:print:]]/
        @text << key
      end
    end

    def on key, &action
      @keys[key] = action
    end

    def to_s
      @text
    end

    private
      def wrap action
        -> self { instance_exec &action }
      end
  end
end
